{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { SyntheticPlatformEmitter, CodedError } from 'expo-modules-core';\nimport { VoiceQuality } from \"./Speech.types\";\nvar MAX_SPEECH_INPUT_LENGTH = 32767;\n\nfunction _getVoices() {\n  return _regeneratorRuntime.async(function getVoices$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          return _context.abrupt(\"return\", new Promise(function (resolve) {\n            var voices = window.speechSynthesis.getVoices();\n\n            if (voices.length > 0) {\n              resolve(voices);\n              return;\n            }\n\n            window.speechSynthesis.onvoiceschanged = function () {\n              var voices = window.speechSynthesis.getVoices();\n              resolve(voices);\n            };\n          }));\n\n        case 1:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nexport default {\n  get name() {\n    return 'ExponentSpeech';\n  },\n\n  speak: function speak(id, text, options) {\n    return function _callee() {\n      var message, voices, _voices;\n\n      return _regeneratorRuntime.async(function _callee$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(text.length > MAX_SPEECH_INPUT_LENGTH)) {\n                _context2.next = 2;\n                break;\n              }\n\n              throw new CodedError('ERR_SPEECH_INPUT_LENGTH', 'Speech input text is too long! Limit of input length is: ' + MAX_SPEECH_INPUT_LENGTH);\n\n            case 2:\n              message = new SpeechSynthesisUtterance();\n\n              if (typeof options.rate === 'number') {\n                message.rate = options.rate;\n              }\n\n              if (typeof options.pitch === 'number') {\n                message.pitch = options.pitch;\n              }\n\n              if (typeof options.language === 'string') {\n                message.lang = options.language;\n              }\n\n              if (typeof options.volume === 'number') {\n                message.volume = options.volume;\n              }\n\n              if (!('_voiceIndex' in options && options._voiceIndex != null)) {\n                _context2.next = 12;\n                break;\n              }\n\n              _context2.next = 10;\n              return _regeneratorRuntime.awrap(_getVoices());\n\n            case 10:\n              voices = _context2.sent;\n              message.voice = voices[Math.min(voices.length - 1, Math.max(0, options._voiceIndex))];\n\n            case 12:\n              if (!(typeof options.voice === 'string')) {\n                _context2.next = 17;\n                break;\n              }\n\n              _context2.next = 15;\n              return _regeneratorRuntime.awrap(_getVoices());\n\n            case 15:\n              _voices = _context2.sent;\n              message.voice = _voices[Math.max(0, _voices.findIndex(function (voice) {\n                return voice.voiceURI === options.voice;\n              }))];\n\n            case 17:\n              if (typeof options.onResume === 'function') {\n                message.onresume = options.onResume;\n              }\n\n              if (typeof options.onMark === 'function') {\n                message.onmark = options.onMark;\n              }\n\n              if (typeof options.onBoundary === 'function') {\n                message.onboundary = options.onBoundary;\n              }\n\n              message.onstart = function (nativeEvent) {\n                SyntheticPlatformEmitter.emit('Exponent.speakingStarted', {\n                  id: id,\n                  nativeEvent: nativeEvent\n                });\n              };\n\n              message.onend = function (nativeEvent) {\n                SyntheticPlatformEmitter.emit('Exponent.speakingDone', {\n                  id: id,\n                  nativeEvent: nativeEvent\n                });\n              };\n\n              message.onpause = function (nativeEvent) {\n                SyntheticPlatformEmitter.emit('Exponent.speakingStopped', {\n                  id: id,\n                  nativeEvent: nativeEvent\n                });\n              };\n\n              message.onerror = function (nativeEvent) {\n                SyntheticPlatformEmitter.emit('Exponent.speakingError', {\n                  id: id,\n                  nativeEvent: nativeEvent\n                });\n              };\n\n              message.text = text;\n              window.speechSynthesis.speak(message);\n              return _context2.abrupt(\"return\", message);\n\n            case 27:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  getVoices: function getVoices() {\n    return function _callee2() {\n      var voices;\n      return _regeneratorRuntime.async(function _callee2$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(_getVoices());\n\n            case 2:\n              voices = _context3.sent;\n              return _context3.abrupt(\"return\", voices.map(function (voice) {\n                return {\n                  identifier: voice.voiceURI,\n                  quality: VoiceQuality.Default,\n                  isDefault: voice.default,\n                  language: voice.lang,\n                  localService: voice.localService,\n                  name: voice.name,\n                  voiceURI: voice.voiceURI\n                };\n              }));\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  isSpeaking: function isSpeaking() {\n    return function _callee3() {\n      return _regeneratorRuntime.async(function _callee3$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              return _context4.abrupt(\"return\", window.speechSynthesis.speaking);\n\n            case 1:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  stop: function stop() {\n    return function _callee4() {\n      return _regeneratorRuntime.async(function _callee4$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              return _context5.abrupt(\"return\", window.speechSynthesis.cancel());\n\n            case 1:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  pause: function pause() {\n    return function _callee5() {\n      return _regeneratorRuntime.async(function _callee5$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              return _context6.abrupt(\"return\", window.speechSynthesis.pause());\n\n            case 1:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  resume: function resume() {\n    return function _callee6() {\n      return _regeneratorRuntime.async(function _callee6$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              return _context7.abrupt(\"return\", window.speechSynthesis.resume());\n\n            case 1:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }();\n  },\n  maxSpeechInputLength: MAX_SPEECH_INPUT_LENGTH\n};","map":{"version":3,"sources":["../src/Speech/ExponentSpeech.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { SyntheticPlatformEmitter, CodedError } from 'expo-modules-core';\n\nimport { SpeechOptions, WebVoice, VoiceQuality } from './Speech.types';\n\n//https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance/text\nconst MAX_SPEECH_INPUT_LENGTH = 32767;\n\nasync function getVoices(): Promise<SpeechSynthesisVoice[]> {\n  return new Promise<SpeechSynthesisVoice[]>((resolve) => {\n    const voices = window.speechSynthesis.getVoices();\n\n    if (voices.length > 0) {\n      resolve(voices);\n      return;\n    }\n\n    // when a page loads it takes some amount of time to populate the voices list\n    // see https://stackoverflow.com/a/52005323/4337317\n    window.speechSynthesis.onvoiceschanged = function () {\n      const voices = window.speechSynthesis.getVoices();\n      resolve(voices);\n    };\n  });\n}\n\nexport default {\n  get name(): string {\n    return 'ExponentSpeech';\n  },\n  async speak(id: string, text: string, options: SpeechOptions): Promise<SpeechSynthesisUtterance> {\n    if (text.length > MAX_SPEECH_INPUT_LENGTH) {\n      throw new CodedError(\n        'ERR_SPEECH_INPUT_LENGTH',\n        'Speech input text is too long! Limit of input length is: ' + MAX_SPEECH_INPUT_LENGTH\n      );\n    }\n\n    const message = new SpeechSynthesisUtterance();\n\n    if (typeof options.rate === 'number') {\n      message.rate = options.rate;\n    }\n    if (typeof options.pitch === 'number') {\n      message.pitch = options.pitch;\n    }\n    if (typeof options.language === 'string') {\n      message.lang = options.language;\n    }\n    if (typeof options.volume === 'number') {\n      message.volume = options.volume;\n    }\n    if ('_voiceIndex' in options && options._voiceIndex != null) {\n      const voices = await getVoices();\n      message.voice = voices[Math.min(voices.length - 1, Math.max(0, options._voiceIndex))];\n    }\n    if (typeof options.voice === 'string') {\n      const voices = await getVoices();\n      message.voice =\n        voices[\n          Math.max(\n            0,\n            voices.findIndex((voice) => voice.voiceURI === options.voice)\n          )\n        ];\n    }\n    if (typeof options.onResume === 'function') {\n      message.onresume = options.onResume;\n    }\n    if (typeof options.onMark === 'function') {\n      message.onmark = options.onMark;\n    }\n    if (typeof options.onBoundary === 'function') {\n      message.onboundary = options.onBoundary;\n    }\n\n    message.onstart = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingStarted', { id, nativeEvent });\n    };\n    message.onend = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingDone', { id, nativeEvent });\n    };\n    message.onpause = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingStopped', { id, nativeEvent });\n    };\n    message.onerror = (nativeEvent: SpeechSynthesisErrorEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingError', { id, nativeEvent });\n    };\n\n    message.text = text;\n\n    window.speechSynthesis.speak(message);\n\n    return message;\n  },\n  async getVoices(): Promise<WebVoice[]> {\n    const voices = await getVoices();\n    return voices.map((voice) => ({\n      identifier: voice.voiceURI,\n      quality: VoiceQuality.Default,\n      isDefault: voice.default,\n      language: voice.lang,\n      localService: voice.localService,\n      name: voice.name,\n      voiceURI: voice.voiceURI,\n    }));\n  },\n  async isSpeaking(): Promise<boolean> {\n    return window.speechSynthesis.speaking;\n  },\n  async stop(): Promise<void> {\n    return window.speechSynthesis.cancel();\n  },\n  async pause(): Promise<void> {\n    return window.speechSynthesis.pause();\n  },\n  async resume(): Promise<void> {\n    return window.speechSynthesis.resume();\n  },\n  maxSpeechInputLength: MAX_SPEECH_INPUT_LENGTH,\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}